## 使用说明

将media文件夹放入/var/下。

在./src/server目录下执行make，然后./server -F 指定服务器前台运行

在./src/client目录下执行make，然后./client

在打印出节目单后，在命令行输入 1～5 选择频道进行播放

注意：

```shell
	sudo apt-get install mgp123 -y
```

## 项目分析

### client端

1. 首先创建socket，并且设置一些socket的属性，然后bind绑定端口。

2. 创建管道

3. fork子进程，子进程通过dup2函数将管道的读端复制到0号描述符，然后通过exec函数族调用解码器。

4. 父进程呢就是通过recvfrom函数先从网络上获取节目单信息，然后打印节目单并选择频道，然后就是收频道的数据包，通过写管道发送给子进程。

### server端

1. 解析命令行（比如指定媒体库的路径，指定程序是前台运行或者是守护进程，指定多播组，网络端口等等）

2. 用到了信号，使用sigaction设置某些信号的处理方式。（主要就是在程序被杀死之前释放一些内存，避免造成内存泄漏）

3. 对socket初始化（socket()创建socket、setsockopt()设置一些属性，bind()在主动端可以省略）

4. 通过文件目录的分析整理出频道信息。（主要用到一个函数就是glob(),）

5. 创建一个节目单线程，负责每隔1s往外发送一次节目单。（sendto函数，参数socket描述符，发送的内容，大小，特殊要求，发送的地址的结构体，地址结构体的大小）

6. 通过整理出的频道的个数，创建出频道线程，每个线程负责发送每个频道的内容。

7. 流量控制，流量控制是通过令牌桶算法实现，在要创建频道线程之前，对令牌桶进行初始化，然后令牌桶模块创建一个子线程，子线程就负责固定每秒往桶里放多少个令牌，然后频道线程要发送数据的时候去取令牌，取出多少个令牌就往出发多少个字节。





